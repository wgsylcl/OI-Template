# 卡特兰数
**本页中$C_i$表示卡特兰数第$i$项，$C_n^m$表示在$n$个元素中选$m$个的组合数**
## 定义与递推公式

卡特兰数$C_i$定义为将$i$个元素依次进栈出栈的合法出栈序列数

考虑元素$1$在第$k$个出栈，则$1$前共有$k-1$个元素出栈，$1$后共有$n-k$个元素出栈

要使整个出栈序列合法，$1$前后的$k-1$，$n-k$个元素的出栈序列都要合法，则有
$$C_i=\sum_{k=1}^iC_{k-1}\times C_{i-k}$$

## 卡特兰数有关公式的证明及变形

将每次进栈操作记为$+1$，每次出栈操作记为$-1$，则所有的操作构成一个长为$2i$的序列

显然，序列的所有排列方式为$C_{2n}^n$

我们发现，任何时候出栈元素个数大于进栈元素个数时，这个序列一定不合法

这在序列中表现为至少有一个位置的前缀和小于$0$

如何快速求出所有不合法的排列数？

考虑一个由$n-1$个$+1$和$n+1$个$-1$构成的序列，因为$-1$个数较多，必有至少一个位置的前缀和小于$0$

我们记前缀和第一次为$-1$的位置为$i$，容易发现$i$一定为奇数

则前$i$个元素中有$\left\lfloor \frac{i}{2} \right\rfloor$个$+1$，$\left\lfloor \frac{i}{2} \right\rfloor+1$个$-1$，$-1$比$+1$多一个

那么后$2n-i$个元素中$-1$同样比$+1$多一个

我们将后$2n-i$个元素取反，就得到了一个不合法的由$n$个$+1$和$n$个$-1$组成的序列

这样的序列一共有$C_{2n}^{n+1}$或$C_{2n}^{n+1}$个

将所有可能的排列个数减去不合法的排列个数，就得到了
$$C_n=C_{2n}^{n}-C_{2n}^{n-1}=C_{2n}^{n}-C_{2n}^{n+1}$$

又有$\displaystyle{C_n^m=\frac{n!}{m!(n-m)!}}$，可得$\displaystyle{C_n=\frac{C_{2n}^n}{n+1}}$

再将$C_n$与$C_{n-1}$相除，可得$\displaystyle{C_n=C_{n-1}\times\frac{4n-2}{n+1}}$

我们便得到了卡特兰数的三种主要计算方法

## 卡特兰数的主要应用
+ $n$对括号的合法匹配数目
+ $n\times n$的网格图，从左下角沿网格线走到右上角,且不经过对角线下方的情况数
+ $n$个结点的二叉搜索树个数
+ $n+2$边形通过对角线划分成$n$个三角形的方法数